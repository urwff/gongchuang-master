# 工创项目技术栈文档

## 项目概述
这是一个基于STM32微控制器的工创机器人控制系统，实现了基于二维码识别的自动物料搬运、分类和码垛功能。

## 硬件平台

### 主控制器
- **微控制器**: STM32F103ZE (ARM Cortex-M3内核)
- **Flash**: 512KB
- **RAM**: 64KB
- **时钟**: 12MHz外部晶振
- **厂商**: STMicroelectronics

### 传感器模块
- **MPU6050**: 6轴姿态传感器，提供加速度和陀螺仪数据
- **GY-61**: 加速度传感器模块
- **视觉系统**: 二维码和颜色识别（通过串口与树莓派通信）
- **编码器**: 步进电机位置反馈

### 执行器
- **直流电机**: 4轮驱动底盘运动
- **步进电机**: 升降机高度控制
- **舵机**: 机械臂关节控制
- **电磁阀**: 气动爪子控制
- **LED指示灯**: 状态显示
- **蜂鸣器**: 声音提示
- **OLED显示屏**: 人机界面

## 开发环境

### IDE和工具链
- **开发工具**: Keil MDK-ARM v5.06
- **编译器**: ARM Compiler v5.06 (ARMCC)
- **调试器**: J-Link (SEGGER)
- **设备包**: Keil.STM32F1xx_DFP.2.2.0

### 编程语言
- **主要语言**: C语言 (99.9%)
- **文件数量**:
  - C源文件: 58个
  - 头文件: 64个
- **编码**: UTF-8 (支持中文注释)

## 软件架构

### 操作系统
- **实时系统**: 前后台系统（无RTOS）
- **调度方式**: 基于定时器中断的任务调度
- **中断管理**: NVIC中断向量控制器

### 驱动层
- **STM32固件库**: STM32F10x Firmware Library
- **外设驱动**:
  - GPIO: 通用输入输出
  - TIM: 定时器/PWM输出
  - USART: 多串口通信
  - I2C: 传感器通信
  - SPI: 显示屏通信

### 中间件
- **MPU6050 DMP库**: 运动处理库，提供姿态解算
- **Lobot舵机控制**: 舵机通信协议
- **OLED驱动**: 显示控制

### 应用层架构
```
应用层 (APP/)
├── 目标检测与抓取 (Targets/)
├── 升降机控制 (Elevator_Control/)
├── 传感器接口 (MPU6050/, GY-61/)
├── 人机界面 (HMI_DISPLAY/, OLED/)
└── 舵机控制 (LobotServoController/)

系统层 (SYSTEM/)
├── 延时功能 (delay/)
├── 按键输入 (key/)
├── LED控制 (LED/)
├── 定时器配置 (TIM/)
└── 串口通信 (USART/)

硬件抽象层 (bsp/)
├── 板级支持包 (BSP.c)
├── 机械臂控制 (bsp_Arm_Steering/)
├── 电机控制 (bsp_Motor_4w/)
├── 定时器配置 (bsp_Timer/)
└── 串口配置 (bsp_usart/)
```

## 通信协议

### 串口通信
- **USART1**: 调试输出
- **USART2**: 传感器数据
- **USART3**: 扩展通信
- **UART4**: 视觉系统通信（树莓派）
- **UART5**: 扩展通信

### 通信协议格式
- **视觉系统**: 8字节数据包，以0x5D结束
- **舵机控制**: Lobot协议
- **传感器**: I2C标准协议

## 控制算法

### 运动控制
- **PID控制**: 电机速度闭环控制
- **轨迹规划**: 多段式路径规划
- **位置反馈**: 编码器闭环控制

### 视觉伺服
- **颜色识别**: HSV颜色空间分析
- **二维码识别**: OpenCV图像处理
- **位置校正**: 基于视觉反馈的精确定位

### 姿态控制
- **传感器融合**: 加速度计+陀螺仪数据融合
- **欧拉角解算**: DMP运动处理库
- **姿态稳定**: 倾斜角度控制

## 电源管理

### 供电系统
- **主电源**: 12V锂电池
- **逻辑电源**: 5V/3.3V稳压
- **电机电源**: 独立12V供电

### 功耗管理
- **睡眠模式**: 系统空闲时进入低功耗
- **外设管理**: 按需开启/关闭外设电源

## 开发工具和辅助软件

### 版本控制
- **工具**: Git
- **配置文件**: .gitignore

### 辅助工具
- **Claude Code**: AI辅助开发工具
- **进程管理**: keilkilll.bat (Keil进程终止脚本)

### 调试工具
- **硬件调试**: J-Link调试器
- **串口调试**: 串口助手
- **逻辑分析**: 信号时序分析

## 性能参数

### 系统性能
- **主频**: 72MHz (Cortex-M3)
- **响应时间**: < 1ms (中断响应)
- **定位精度**: ±1mm (视觉校正后)

### 运动参数
- **最大速度**: 15000 脉冲/秒
- **最小速度**: 150 脉冲/秒
- **调整速度**: 400 脉冲/秒

## 扩展接口

### 硬件扩展
- **I2C设备**: 可扩展传感器
- **SPI设备**: 可扩展显示屏
- **GPIO**: 可扩展数字IO

### 软件扩展
- **模块化设计**: 支持功能模块扩展
- **配置化**: 参数可配置调整
- **协议扩展**: 支持新通信协议

## 安全和容错

### 安全机制
- **急停功能**: 硬件急停开关
- **过流保护**: 电机过载保护
- **位置限制**: 机械限位开关

### 容错处理
- **通信重试**: 串口通信错误重试
- **位置校正**: 视觉反馈位置校正
- **异常恢复**: 系统异常自动恢复

## 项目特点

1. **嵌入式实时系统**: 基于Cortex-M3的实时控制
2. **多传感器融合**: 姿态、视觉、位置传感器协同工作
3. **智能物料处理**: 二维码识别和自动分类
4. **精确定位**: 视觉伺服和编码器反馈
5. **模块化架构**: 清晰的软硬件分层设计
6. **中文开发**: 完善的中文注释和文档

该技术栈文档详细描述了工创项目使用的硬件平台、软件架构、开发工具和核心技术，为系统开发和维护提供了完整的技术参考。